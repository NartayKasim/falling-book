{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/KASIM/Documents/falling-book/bookist-alpha/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/KASIM/Documents/falling-book/bookist-alpha/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:/Users/KASIM/Documents/falling-book/bookist-alpha/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/KASIM/Documents/falling-book/bookist-alpha/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect}from\"react\";import{useState}from\"react\";import{v4 as uuidv4}from\"uuid\";import{useSelector}from\"react-redux\";import axios from\"axios\";import classes from\"./Reviews.module.css\";import Review from\"./Review\";import ComposeReview from\"./ComposeReview\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Reviews(_ref){var book=_ref.book,updateBook=_ref.updateBook;var isLoggedIn=useSelector(function(state){return state.library.isLoggedIn;});var _useState=useState(null),_useState2=_slicedToArray(_useState,2),reviews=_useState2[0],setReviews=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),targetReview=_useState4[0],setTargetReview=_useState4[1];var onReviewContentChange=function onReviewContentChange(val){if(!val){return setTargetReview({});}setTargetReview(_objectSpread(_objectSpread({},targetReview),{},{content:val}));};var onSubmitReviewClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(targetReview.review_id&&targetReview.content&&targetReview.content.length>0){axios.post(\"/api/library/review\",{book:book,review:targetReview}).then(function(response){return setReviews(response.data);});}else{if(targetReview.content.length>0){axios.post(\"/api/library/review\",{book:book,review:{content:targetReview.content}}).then(function(response){if(response.data.length===2){setReviews(response.data[0]);updateBook(response.data[1]);}else{setReviews(response.data);}});}}setTargetReview({});case 2:case\"end\":return _context.stop();}}},_callee);}));return function onSubmitReviewClick(){return _ref2.apply(this,arguments);};}();var onDeleteReviewClick=function onDeleteReviewClick(review){axios.post(\"/api/library/review/delete\",{book:book,review_id:review.review_id}).then(function(){return setReviews(null);});};useEffect(function(){var getReviews=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(\"/api/library/get-reviews/\".concat(book.book_id));case 2:response=_context2.sent;setReviews(response.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function getReviews(){return _ref3.apply(this,arguments);};}();if(reviews===null&&book.book_id){getReviews();}},[book,reviews]);return/*#__PURE__*/_jsxs(\"div\",{className:classes.reviews,children:[isLoggedIn&&/*#__PURE__*/_jsx(ComposeReview,{content:targetReview.content||\"\",onReviewContentChange:onReviewContentChange,onSubmitReviewClick:onSubmitReviewClick}),reviews!==null&&reviews.length>0&&reviews.map(function(review){return/*#__PURE__*/_jsx(Review,{review:review,setTargetReview:setTargetReview,onDeleteReviewClick:onDeleteReviewClick},uuidv4());})]});}","map":{"version":3,"sources":["C:/Users/KASIM/Documents/falling-book/bookist-alpha/client/src/components/book/reviews/Reviews.jsx"],"names":["useEffect","useState","v4","uuidv4","useSelector","axios","classes","Review","ComposeReview","Reviews","book","updateBook","isLoggedIn","state","library","reviews","setReviews","targetReview","setTargetReview","onReviewContentChange","val","content","onSubmitReviewClick","review_id","length","post","review","then","response","data","onDeleteReviewClick","getReviews","get","book_id","map"],"mappings":"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","sourcesContent":["import { useEffect } from \"react\";\r\nimport { useState } from \"react\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport { useSelector } from \"react-redux\";\r\nimport axios from \"axios\";\r\nimport classes from \"./Reviews.module.css\";\r\nimport Review from \"./Review\";\r\nimport ComposeReview from \"./ComposeReview\";\r\n\r\nexport default function Reviews({ book, updateBook }) {\r\n   const isLoggedIn = useSelector((state) => state.library.isLoggedIn);\r\n   const [reviews, setReviews] = useState(null);\r\n   const [targetReview, setTargetReview] = useState({});\r\n\r\n   const onReviewContentChange = (val) => {\r\n      if (!val) {\r\n         return setTargetReview({});\r\n      }\r\n      setTargetReview({ ...targetReview, content: val });\r\n   };\r\n\r\n   const onSubmitReviewClick = async () => {\r\n      if (\r\n         targetReview.review_id &&\r\n         targetReview.content &&\r\n         targetReview.content.length > 0\r\n      ) {\r\n         axios\r\n            .post(\"/api/library/review\", { book, review: targetReview })\r\n            .then((response) => setReviews(response.data));\r\n      } else {\r\n         if (targetReview.content.length > 0) {\r\n            axios\r\n               .post(\"/api/library/review\", {\r\n                  book,\r\n                  review: { content: targetReview.content },\r\n               })\r\n               .then((response) => {\r\n                  if (response.data.length === 2) {\r\n                     setReviews(response.data[0]);\r\n                     updateBook(response.data[1]);\r\n                  } else {\r\n                     setReviews(response.data);\r\n                  }\r\n               });\r\n         }\r\n      }\r\n      setTargetReview({});\r\n   };\r\n\r\n   const onDeleteReviewClick = (review) => {\r\n      axios\r\n         .post(\"/api/library/review/delete\", {\r\n            book,\r\n            review_id: review.review_id,\r\n         })\r\n         .then(() => setReviews(null));\r\n   };\r\n\r\n   useEffect(() => {\r\n      const getReviews = async () => {\r\n         const response = await axios.get(\r\n            `/api/library/get-reviews/${book.book_id}`\r\n         );\r\n         setReviews(response.data);\r\n      };\r\n      if (reviews === null && book.book_id) {\r\n         getReviews();\r\n      }\r\n   }, [book, reviews]);\r\n\r\n   return (\r\n      <div className={classes.reviews}>\r\n         {isLoggedIn && (\r\n            <ComposeReview\r\n               content={targetReview.content || \"\"}\r\n               onReviewContentChange={onReviewContentChange}\r\n               onSubmitReviewClick={onSubmitReviewClick}\r\n            />\r\n         )}\r\n\r\n         {reviews !== null &&\r\n            reviews.length > 0 &&\r\n            reviews.map((review) => (\r\n               <Review\r\n                  review={review}\r\n                  setTargetReview={setTargetReview}\r\n                  onDeleteReviewClick={onDeleteReviewClick}\r\n                  key={uuidv4()}\r\n               />\r\n            ))}\r\n      </div>\r\n   );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}